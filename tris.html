<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tris Mania - GBA (NES)</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<link rel="website icon" type="png" href="img/TRIS.png">
<style>
html, body {
  overflow: hidden;
  height: 100%;
  margin: 0;
  font-family: 'Press Start 2P', monospace;
  background: linear-gradient(180deg, #081018, #07101a);
  color: #EAE6DA;
  display: flex;
  align-items: center;
  justify-content: center;
}

:root {
  --accent: #FFD27F;
  --text: #EAE6DA;
  --muted: #9AA6B2;
}

.frame {
  width: 100%;
  max-width: 400px;
  background: linear-gradient(180deg,#081827,#041018);
  border: 4px solid #000;
  padding: 16px;
  border-radius: 6px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 16px;
}

.header {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo { color: var(--accent); font-size: 14px; }

.controls { display: flex; gap: 8px; }

.btn {
  padding: 8px 10px;
  background: #111;
  border: 3px solid #000;
  color: var(--text);
  cursor: pointer;
  border-radius: 6px;
  font-size: 10px;
}

.btn:hover { background: var(--accent); color: #000; }

.board {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 6px;
  width: 100%;
  max-width: 320px;
}

.cell {
  width: 100%;
  aspect-ratio: 1 / 1;
  background: #081827;
  border: 2px solid #000;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  position: relative;
}

.cell span {
  font-size: 2rem;
  line-height: 1;
  color: var(--text);
  pointer-events: none;
}

.hud {
  font-size: 12px;
  color: var(--text);
  text-align: center;
}

.scan {
  position: fixed;
  inset: 0;
  pointer-events: none;
  background-image: linear-gradient(rgba(0,0,0,0.03) 50%, transparent 51%);
  background-size: 100% 4px;
  opacity: .35;
}

.footer { position: fixed; bottom: 25px; color: var(--muted); font-size: 11px;align-items: center; }
.credits { position: fixed; bottom: 4px; color: var(--muted); font-size: 11px;align-items: center; }

@media(max-width:400px){
  .frame { max-width: 100%; padding: 12px; }
  .btn { font-size: 9px; padding: 6px 8px; }
  .hud { font-size: 11px; }
  .cell span { font-size: 1.6rem; }
}
</style>
</head>
<body>
<div class="frame">
  <div class="header">
    <div class="logo">GBA â€” TrisMania</div>
    <div class="controls">
      <div class="btn" id="btnResetRound">RIAVVIA</div>
      <div class="btn" id="btnMenu" onclick="location.href='index.html'">MENU</div>
    </div>
  </div>

  <div id="board" class="board"></div>

  <div class="hud">
    <div>Round score</div>
    <div>O: <span id="scoreO">0</span></div>
    <div>X: <span id="scoreX">0</span></div>
    <div style="margin-top:8px;color:#FFD27F" id="status">Turno: O</div>
  </div>
</div>

<div class="scan"></div>
<div class="footer">Versione Beta (1.0.0)</div>
<div class="credits">Fatto da Anto e ChatGPT</div>

<script>
const boardEl = document.getElementById('board');
let grid = Array(9).fill('');
let turn = 'O';
let active = true;
let scoreO = 0, scoreX = 0;

const scoreOEl = document.getElementById('scoreO');
const scoreXEl = document.getElementById('scoreX');
const statusEl = document.getElementById('status');

function renderBoard() {
  boardEl.innerHTML = '';
  grid.forEach((v, i) => {
    const c = document.createElement('div');
    c.className = 'cell';
    c.dataset.i = i;
    const s = document.createElement('span');
    s.textContent = v;
    c.appendChild(s);
    c.addEventListener('click', () => cellClick(i));
    boardEl.appendChild(c);
  });
}

function cellClick(i) {
  if(!active || grid[i] !== '') return;
  grid[i] = turn;
  renderBoard();

  const w = checkWinner();
  if(w) {
    active = false;
    setTimeout(() => endRound(w), 300);
    return;
  }

  // controllo pareggio
  if(!grid.includes('')) {
    active = false;
    statusEl.textContent = 'Pareggio';
    // resetta il round senza incrementare i punteggi
    setTimeout(resetRound, 900);
    return;
  }

  turn = (turn === 'O') ? 'X' : 'O';
  statusEl.textContent = 'Turno: ' + turn;
}


function checkWinner() {
  const lines = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];
  for(let line of lines) {
    const [a,b,c] = line;
    if(grid[a] && grid[a] === grid[b] && grid[a] === grid[c]) return grid[a];
  }
  return null;
}

function endRound(winner) {
  if(winner === 'O') scoreO++; else scoreX++;
  scoreOEl.textContent = scoreO;
  scoreXEl.textContent = scoreX;
  statusEl.textContent = `Vince il round: ${winner}`;

  if(scoreO >= 3 || scoreX >= 3){
    setTimeout(() => {
      statusEl.textContent = `Vince la partita: ${winner}`;
      setTimeout(() => {
        scoreO = 0; scoreX = 0;
        scoreOEl.textContent = '0'; scoreXEl.textContent = '0';
        resetRound();
      }, 1000);
    }, 500);
  } else {
    setTimeout(resetRound, 900);
  }
}

function resetRound() {
  grid = Array(9).fill('');
  turn = 'O';
  active = true;
  statusEl.textContent = 'Turno: O';
  renderBoard();
}

document.getElementById('btnResetRound').addEventListener('click', resetRound);

renderBoard();
</script>
</body>
</html>
