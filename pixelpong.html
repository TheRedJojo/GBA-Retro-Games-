<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>PixelPong - GBA (NES)</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<link rel="website icon" type="png" href="img/PONG.png">
<style>
:root{
    --bg:#081018;
    --panel:#0f1724;
    --accent:#FFD27F;
    --muted:#9AA6B2;
    --text:#EAE6DA;
}
html, body {
    margin:0; padding:0;
    height:100%; width:100%;
    overflow:hidden;
    font-family:'Press Start 2P',monospace;
    background: linear-gradient(180deg,var(--bg),#07101a);
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    touch-action:none;
    -webkit-user-select:none; user-select:none;
}
.wrapper{
    width:90vw; max-width:360px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
    border:3px solid #000; border-radius:6px; padding:8px;
    display:flex; flex-direction:column; align-items:center; gap:8px;
}
.logo{ color:var(--accent); font-size:10px; text-align:center; }
.canvasWrap{ width:100%; position:relative; border:2px solid #000; border-radius:4px; padding:4px; background:#07101a; }
canvas{ width:100%; height:auto; display:block; background:#111; border:1px solid #000; image-rendering:pixelated; }
.hud{ width:100%; color:var(--text); font-size:10px; display:flex; flex-direction:column; align-items:center; gap:2px; text-align:center;}
#message{ color:var(--accent); min-height:16px; font-size:9px; text-align:center;}
.controls{ display:flex; justify-content:center; gap:6px; flex-wrap:wrap; margin-top:4px; }
.btn{ flex:1 1 45%; padding:8px 6px; background:#111; border:2px solid #000; color:var(--text); text-align:center; border-radius:4px; cursor:pointer; font-size:9px;}
.btn:hover{ background:var(--accent); color:#000; transform:translateY(-1px);}
.arrows{ display:flex; flex-direction:column; align-items:center; margin-top:6px; gap:4px; }
.arrow-row{ display:flex; justify-content:center; gap:4px; }
.arrow{ width:32px; height:32px; background:#111; border:2px solid #000; border-radius:4px; color:var(--text); display:flex; align-items:center; justify-content:center; font-size:12px; cursor:pointer; user-select:none;}
.arrow:active{ background:var(--accent); color:#000; }
select{ background:#111; color:var(--text); border:2px solid #000; border-radius:4px; font-family:'Press Start 2P',monospace; font-size:9px; padding:4px; cursor:pointer; }
.footer,.credits{ font-size:8px; color:var(--muted); position:fixed; }
.footer { bottom: 12px; } .credits { bottom: 2px; }
.scan{ position:fixed; inset:0; pointer-events:none; background-image:linear-gradient(rgba(0,0,0,0.03) 50%, transparent 51%); background-size:100% 4px; opacity:0.35;}
</style>
</head>
<body>
<div class="wrapper">
  <div class="logo">GBA — PixelPong</div>
  <div class="canvasWrap">
    <canvas id="game" width="270" height="270"></canvas>
  </div>
  <div class="hud">
    <div id="scoreboard">TU 0 vs IA (Media) 0</div>
    <div id="message"></div>
    <div>Difficoltà IA: 
      <select id="difficulty">
        <option value="2">Facile</option>
        <option value="4" selected>Media</option>
        <option value="6">Difficile</option>
      </select>
    </div>
  </div>
  <div class="controls">
    <div class="btn" id="btnRestart">RIAVVIA</div>
    <div class="btn" id="btnMenu" onclick="location.href='index.html'">MENU</div>
  </div>
  <div class="arrows">
    <div class="arrow-row"><div class="arrow" data-dir="up">▲</div></div>
    <div class="arrow-row"><div class="arrow" data-dir="down">▼</div></div>
  </div>
  <div style="font-size:9px;color:var(--muted);margin-top:4px;text-align:center;">Controlli: frecce / swipe / pulsanti</div>
</div>

<div class="scan"></div>
<div class="footer">Versione Beta (1.0.1)</div>
<div class="credits">Fatto da Anto e ChatGPT</div>

<script>
const canvas=document.getElementById('game'), ctx=canvas.getContext('2d');
const GRID=15, paddleHeight=GRID*4, playerSpeed=7;
let player={x:10,y:canvas.height/2-paddleHeight/2}, ai={x:canvas.width-20,y:canvas.height/2-paddleHeight/2};
let ball={x:canvas.width/2,y:canvas.height/2,dx:3,dy:3,radius:GRID/2};
let playerScore=parseInt(localStorage.getItem('gba_pong_player')||0);
let aiScore=parseInt(localStorage.getItem('gba_pong_ai')||0);
let servePlayer=true; // chi serve
let running=false, timer=null;
const scoreboard=document.getElementById('scoreboard');
const msg=document.getElementById('message');
const diffSelect=document.getElementById('difficulty');

function reset(start=false){
    player.y=canvas.height/2-paddleHeight/2;
    ai.y=canvas.height/2-paddleHeight/2;
    ballServe(); // palla parte dal paddle che serve
    running=false;
    msg.textContent='';
    render();
    if(start) startLoop();
}

function ballServe(){
    ball.x = servePlayer ? player.x+10+ball.radius : ai.x-ball.radius-1;
    ball.y = canvas.height/2;
    ball.dx = servePlayer ? 3 : -3;
    ball.dy = (Math.random()*4-2);
}

function render(){
    ctx.fillStyle='#081018'; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='#FFD27F';
    ctx.fillRect(player.x,player.y,10,paddleHeight);
    ctx.fillRect(ai.x,ai.y,10,paddleHeight);
    ctx.beginPath();
    ctx.arc(ball.x,ball.y,ball.radius,0,Math.PI*2); ctx.fillStyle='#FF4040'; ctx.fill();
    scoreboard.textContent=`TU ${playerScore} vs IA (${diffSelect.options[diffSelect.selectedIndex].text}) ${aiScore}`;
}

function startLoop(){
    if(timer) clearInterval(timer);
    timer=setInterval(loop,16);
    running=true;
}

function loop(){
    if(!running) return;

    // muovi palla
    ball.x += ball.dx; ball.y += ball.dy;
    if(ball.y-ball.radius<0 || ball.y+ball.radius>canvas.height) ball.dy*=-1;

    // collisione paddle
    if(ball.x-ball.radius<player.x+10 && ball.x-ball.radius>player.x && ball.y>player.y && ball.y<player.y+paddleHeight) ball.dx*=-1;
    if(ball.x+ball.radius>ai.x && ball.x+ball.radius<ai.x+10 && ball.y>ai.y && ball.y<ai.y+paddleHeight) ball.dx*=-1;

    // punteggio
    if(ball.x<0){
        aiScore++; localStorage.setItem('gba_pong_ai',aiScore);
        msg.textContent='Hai perso!';
        servePlayer=true; ballServe();
    }
    if(ball.x>canvas.width){
        playerScore++; localStorage.setItem('gba_pong_player',playerScore);
        if(playerScore>parseInt(localStorage.getItem('gba_pong_hs')||0)){
            localStorage.setItem('gba_pong_hs',playerScore);
            msg.textContent='Nuovo record!';
        }
        servePlayer=false; ballServe();
    }

    // IA: reagisce solo se palla sulla sua metà
    let aiSpeed=parseInt(diffSelect.value);
    if(ball.dx>0 && ball.x>canvas.width/2){
        let target = ball.y - paddleHeight/2 + (diffSelect.value==2?Math.random()*20-10:0);
        if(ai.y + paddleHeight/2 < target) ai.y += aiSpeed;
        else ai.y -= aiSpeed;
        if(ai.y<0) ai.y=0; if(ai.y+paddleHeight>canvas.height) ai.y=canvas.height-paddleHeight;
    }

    render();
}

// controlli tastiera
document.addEventListener('keydown',e=>{
    if(e.key==='ArrowUp') player.y-=playerSpeed;
    if(e.key==='ArrowDown') player.y+=playerSpeed;
    if(!running) startLoop();
});

// swipe
let sy=0;
document.addEventListener('touchstart',e=>{sy=e.touches[0].clientY;},{passive:true});
document.addEventListener('touchend',e=>{
    const dy=e.changedTouches[0].clientY-sy;
    if(dy<-20) player.y-=playerSpeed*2;
    if(dy>20) player.y+=playerSpeed*2;
    if(!running) startLoop();
},{passive:true});

// frecce virtuali
document.querySelectorAll('.arrow').forEach(a=>{
    a.addEventListener('click',()=>{
        if(a.dataset.dir==='up') player.y-=playerSpeed*2;
        if(a.dataset.dir==='down') player.y+=playerSpeed*2;
        if(!running) startLoop();
    });
});

document.getElementById('btnRestart').addEventListener('click',()=>reset(true));

reset(true); render();
</script>
</body>
</html>
