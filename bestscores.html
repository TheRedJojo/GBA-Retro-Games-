<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Best Scores - GBA</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<link rel="website icon" type="png" href="img/SNAKE.png">
<style>
:root{
  --bg:#081018;
  --accent:#FFD27F;
  --text:#EAE6DA;
  --muted:#9AA6B2;
  --gold:#FFD700;
  --silver:#C0C0C0;
  --bronze:#CD7F32;
}
html,body{margin:0;padding:0;height:100%;font-family:'Press Start 2P',monospace;background:linear-gradient(180deg,var(--bg),#07101a);color:var(--text);display:flex;align-items:center;justify-content:center;}
.container{ width:94vw; max-width:1100px; display:flex; gap:18px; justify-content:center; align-items:flex-start; flex-wrap:wrap; padding:12px;}
.card{
  width:48%; min-width:300px;
  background:linear-gradient(180deg,#0f1724,#07101a);
  border:4px solid #000;
  padding:16px;
  border-radius:8px;
  text-align:center;
  box-shadow:0 6px 0 #000;
  position:relative;
}
h1{color:var(--accent);font-size:13px;margin:0 0 12px 0;}
.list{display:flex;flex-direction:column;gap:8px;margin-top:12px;}
.item{
  display:flex;align-items:center;justify-content:space-between;
  padding:10px;border:3px solid #000;background:#081018;border-radius:6px;
  font-size:11px;
}
.rank{font-size:12px; width:40px; text-align:left;}
.nick{flex:1;text-align:left;padding-left:8px;}
.score{width:60px;text-align:right;}
.empty{color:var(--muted);font-size:11px;padding:12px;border:3px dashed #000;border-radius:6px;background:rgba(255,255,255,0.01);}
.posLine{margin-top:12px;font-size:11px;color:var(--muted);}
.back{position:fixed; bottom:12px; left:12px; padding:8px 10px; background:#111; border:3px solid #000; border-radius:6px; color:var(--text); cursor:pointer; font-size:11px;}
.back:hover{ background:var(--accent); color:#000;}
.note{margin-top:8px;color:var(--muted);font-size:10px;}
</style>
</head>
<body>
  <div class="container">
    <div class="card" id="snakeCard">
      <h1>PIXEL SNAKE — TOP</h1>
      <div id="snakeList" class="list"></div>
      <div id="snakePos" class="posLine"></div>
      <div class="note">Aggiornamento in tempo reale (Firebase) o locale (localStorage) se non configurato.</div>
    </div>

    <div class="card" id="birdCard">
      <h1>JUMPIN BIRDIE — TOP</h1>
      <div id="birdList" class="list"></div>
      <div id="birdPos" class="posLine"></div>
      <div class="note">Solo giocatori con nickname appaiono qui.</div>
    </div>
  </div>

  <div class="back" onclick="location.href='index.html'">INDIETRO</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ---------- CONFIG - metti qui la stessa config Realtime DB usata in jumpinbirdie.html ---------- */
alert("PAGINA IN MANUTENZIONE! TORNA INDIETRO!")

const firebaseConfig = {
  apiKey: "",
  authDomain: "",
  databaseURL: "",
  projectId: "",
  storageBucket: "",
  messagingSenderId: "",
  appId: ""
};
const firebaseEnabled = Boolean(firebaseConfig.apiKey && firebaseConfig.databaseURL);
if(firebaseEnabled){
  firebase.initializeApp(firebaseConfig);
  var db = firebase.database();
}

/* ---------- util ---------- */
const nick = localStorage.getItem('gba_snake_nick') || null;
function readLocal(key){ try{ return JSON.parse(localStorage.getItem(key)||'[]'); }catch(e){ return []; } }

const snakeListEl = document.getElementById('snakeList'), snakePosEl = document.getElementById('snakePos');
const birdListEl = document.getElementById('birdList'), birdPosEl = document.getElementById('birdPos');

function renderBoard(arr, listEl, posEl, gameLabel){
  if(!arr || !arr.length){
    listEl.innerHTML = '<div class="empty">Nessun punteggio registrato.</div>'; posEl.textContent=''; return;
  }
  arr.sort((a,b)=>b.score - a.score);
  listEl.innerHTML = '';
  arr.slice(0,3).forEach((e,i)=>{
    const div=document.createElement('div'); div.className='item';
    div.innerHTML = `<div class="rank">${i+1}.</div><div class="nick">${e.name}</div><div class="score">${e.score}</div>`;
    if(i===0) div.style.background='linear-gradient(90deg, rgba(255,215,0,0.06), rgba(0,0,0,0.04))';
    if(i===1) div.style.background='linear-gradient(90deg, rgba(192,192,192,0.04), rgba(0,0,0,0.04))';
    if(i===2) div.style.background='linear-gradient(90deg, rgba(205,127,50,0.04), rgba(0,0,0,0.04))';
    listEl.appendChild(div);
  });
  if(!nick){ posEl.textContent = 'Nickname non inserito.'; return; }
  const idx = arr.findIndex(x=>x.name === nick);
  if(idx === -1){ posEl.textContent = 'Non sei ancora in classifica.'; return; }
  posEl.textContent = `Posizione ${idx+1} — ${arr[idx].score} pts`;
}

/* ---------- Data sources ---------- */
if(firebaseEnabled){
  const sRef = db.ref('leaderboards/snake');
  const bRef = db.ref('leaderboards/jumpinbirdie');

  sRef.on('value', snap=>{
    const obj = snap.val() || {};
    const arr = Object.keys(obj).map(k=>({ name: obj[k].name, score: obj[k].score }));
    arr.sort((a,b)=>b.score - a.score);
    try{ localStorage.setItem('snakeLeaderboard', JSON.stringify(arr)); }catch(e){}
    renderBoard(arr, snakeListEl, snakePosEl, 'snake');
  });

  bRef.on('value', snap=>{
    const obj = snap.val() || {};
    const arr = Object.keys(obj).map(k=>({ name: obj[k].name, score: obj[k].score }));
    arr.sort((a,b)=>b.score - a.score);
    try{ localStorage.setItem('jumpinLeaderboard', JSON.stringify(arr)); }catch(e){}
    renderBoard(arr, birdListEl, birdPosEl, 'jumpinbirdie');
  });
} else {
  // fallback polling localStorage (near realtime)
  function refreshLocal(){
    const s = readLocal('snakeLeaderboard');
    const b = readLocal('jumpinLeaderboard');
    renderBoard(s, snakeListEl, snakePosEl, 'snake');
    renderBoard(b, birdListEl, birdPosEl, 'jumpinbirdie');
  }
  refreshLocal();
  setInterval(refreshLocal, 1000);
}
</script>
</body>
</html>
